diff -urN vmmon-only.org/Makefile vmmon-only/Makefile
--- vmmon-only.org/Makefile	2004-05-12 16:49:05.732456176 +0200
+++ vmmon-only/Makefile	2004-05-12 16:57:25.454486880 +0200
@@ -14,9 +14,9 @@
 VM_UNAME = $(shell uname -r)
 
 # Header directory for the running kernel
-HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
+HEADER_DIR = /usr/src/linux/include
 
-BUILD_DIR = $(HEADER_DIR)/..
+BUILD_DIR = .
 
 DRIVER := vmmon
 
@@ -55,9 +55,6 @@
 
 VMCCVER := $(shell $(CC) -dumpversion)
 
-# If there is no version defined, we are in toplevel pass, not yet in kernel makefiles...
-ifeq ($(VERSION),)
-
 ifeq ($(VM_KBUILD), 24)
 DRIVER_KO := $(DRIVER).o
 else
@@ -72,41 +69,14 @@
 $(DRIVER): $(DRIVER_KO)
 	cp -f $< $@
 
-# Pass gcc version down the chain, so we can detect if kernel attempts to use unapproved compiler
-VM_CCVER := $(VMCCVER)
-export VM_CCVER
-VM_CC := $(CC)
-export VM_CC
-
 MAKEOVERRIDES := $(filter-out CC=%,$(MAKEOVERRIDES))
 
 $(DRIVER_KO):
 	make -C $(BUILD_DIR) SUBDIRS=$$PWD SRCROOT=$$PWD/$(SRCROOT) modules
 
-else
-
-ifneq ($(VM_CCVER), $(VMCCVER))
-$(warning *** Inappropriate build environment: you wanted to use gcc \
- version $(VM_CCVER) while kernel attempts to use gcc version $(VMCCVER).)
-$(error For proper build you'll have to replace $(CC) with symbolic \
- link to $(VM_CC))
-endif
-
-endif
 
 include $(SRCROOT)/Makefile.kernel
 
-ifdef TOPDIR
-ifeq ($(VM_KBUILD), 24)
-
-O_TARGET := $(DRIVER).o
-
-obj-y := $($(DRIVER)-y)
-
-include $(TOPDIR)/Rules.make
-endif
-endif
-
 else
 
 include $(SRCROOT)/Makefile.normal
diff -urN vmnet-only.org/Makefile vmnet-only/Makefile
--- vmnet-only.org/Makefile	2004-05-12 16:49:09.091945456 +0200
+++ vmnet-only/Makefile	2004-05-12 16:49:19.904301728 +0200
@@ -14,9 +14,9 @@
 VM_UNAME = $(shell uname -r)
 
 # Header directory for the running kernel
-HEADER_DIR = /lib/modules/$(VM_UNAME)/build/include
+HEADER_DIR = /usr/src/linux/include
 
-BUILD_DIR = $(HEADER_DIR)/..
+BUILD_DIR = .
 
 DRIVER := vmnet
 
@@ -90,9 +67,6 @@
 
 VMCCVER := $(shell $(CC) -dumpversion)
 
-# If there is no version defined, we are in toplevel pass, not yet in kernel makefiles...
-ifeq ($(VERSION),)
-
 ifeq ($(VM_KBUILD), 24)
 DRIVER_KO := $(DRIVER).o
 else
@@ -102,41 +76,13 @@
 auto-build: $(DRIVER_KO)
 	cp -f $< $(SRCROOT)/../$(DRIVER).o
 
-# Pass gcc version down the chain, so we can detect if kernel attempts to use unapproved compiler
-VM_CCVER := $(VMCCVER)
-export VM_CCVER
-VM_CC := $(CC)
-export VM_CC
-
 MAKEOVERRIDES := $(filter-out CC=%,$(MAKEOVERRIDES))
 
 $(DRIVER_KO):
 	make -C $(BUILD_DIR) SUBDIRS=$$PWD SRCROOT=$$PWD/$(SRCROOT) modules
 
-else
-
-ifneq ($(VM_CCVER), $(VMCCVER))
-$(warning *** Inappropriate build environment: you wanted to use gcc \
- version $(VM_CCVER) while kernel attempts to use gcc version $(VMCCVER).)
-$(error For proper build you'll have to replace $(CC) with symbolic \
- link to $(VM_CC))
-endif
-
-endif
-
 include $(SRCROOT)/Makefile.kernel
 
-ifdef TOPDIR
-ifeq ($(VM_KBUILD), 24)
-
-O_TARGET := $(DRIVER).o
-
-obj-y := $($(DRIVER)-y)
-
-include $(TOPDIR)/Rules.make
-endif
-endif
-
 else
 
 include $(SRCROOT)/Makefile.normal
